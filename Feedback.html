<html>

<head>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" ></script>
    <script src="https://code.iconify.design/1/1.0.6/iconify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="FeedbackStyles.css">
    <script>
        //configure me
        var user = "Possum-Labs";
        var repo = "DSL"

        //change at your own risk
        var project = user+"/"+repo;
        var githubProjectUrl = "https://github.com/" + project;
        var issuesNew = "/issues/new?";


        var pathname = "Reference Path:" + window.parent.location.pathname

        function pageQueuryBuilder() {
            return "title=&amp;body=%0A%0A%5BEnter%20feedback%20here%5D%0A%0A%0A---%0A%23%23%23%23%20Document%20Details%0A%0A%E2%9A%A0%20*Do%20not%20edit%20this%20section.%20It%20is%20required%20for%20" +
                project + "%20%E2%9E%9F%20GitHub%20issue%20linking.*%0A%0A*%20Path%3A%20" + pathname
        }

        function projectQueuryBuilder() {
            return "title=&amp;body=%0A%0A%5BEnter%20feedback%20here%5D%0A%0A%0A---%0A%23%23%23%23%20Document%20Details%0A%0A%E2%9A%A0%20*Do%20not%20edit%20this%20section.%20It%20is%20required%20for%20" +
                project + "%20%E2%9E%9F%20GitHub%20issue%20linking.*%0A%0A*%20Source%3A%20" + pathname
        }

        function setLinks() {

            var dataModel = {
                    projectFeedbackUrl: githubProjectUrl + issuesNew + projectQueuryBuilder(),
                    pageFeedbackUrl:githubProjectUrl + issuesNew + pageQueuryBuilder(),
                    githubFeedbackUrl:githubProjectUrl + "/issues/new/choose",
                    openCount: 0,
                    closedCount:0,
                    openIssues:[],
                    closedIssues:[]
                };

            $.ajax({
                url: "https://api.github.com/search/issues?"+
                "q=%22"+"Path%3A%20" + pathname +
                "%22%20type%3Aissue%20in%3Abody%20repo%3A"+user+"%2F"+repo+
                "&sort=created&order=desc"
            }).then(function(data) {
                data.items.forEach(element => {
                    if(element.state === "closed"){
                        dataModel.closedCount++;
                        dataModel.openIssues.push(element);
                    }
                    if(element.state === "open"){
                        dataModel.openCount++;
                        dataModel.closedIssues.push(element);
                    }
                });
            });

            var app = new Vue({
                el: '#app',
                data: dataModel
            });
        }

    </script>
</head>

<body onload="setLinks()">
    <div id="app">
        <section id="SECTION_1">
            <h2 id="H2_2">
                Feedback
            </h2>
            <div id="DIV_3">
                <p id="P_4">
                    Send feedback about
                </p>
                <div id="DIV_5">
                    <a v-bind:href="projectFeedbackUrl" id="project-link-id" class="button-links" target="_blank">
                        <span id="SPAN_7">
                            This project</span>
                        <span class="iconify" data-icon="mdi-exit-to-app" data-inline="false"></span></a>

                    <a v-bind:href="pageFeedbackUrl" id="page-link-id" class="button-links" target="_blank">
                        <span id="SPAN_7">
                            This page</span>
                        <span class="iconify" data-icon="mdi-exit-to-app" data-inline="false"></span></a>


                    <p id="P_20">
                        You may leave feedback directly on 
                        <a target="_blank" v-bind:href="githubFeedbackUrl" id="A_21">
                            GitHub<span class="iconify" data-icon="mdi-github" data-inline="false"></span></a>.
                    </p>
                </div>
            </div>
            <div>

                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item">
                      <a class="nav-link active" id="open-issues-tab" data-toggle="tab" href="#open-issues" role="tab" 
                      aria-controls="open-issues" aria-selected="true">Open ( {{openCount}} )</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" id="closed-issues-tab" data-toggle="tab" href="#closed-issues" role="tab" 
                      aria-controls="closed-issues" aria-selected="false">Closed ( {{closedCount}} )</a>
                    </li>
                  </ul>
                  <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="open-issues" role="tabpanel" aria-labelledby="open-issues-tab">
                        <div v-for="issue in openIssues">
                            {{ issue.title }}
                        </div>
                    </div>
                    <div class="tab-pane fade" id="closed-issues" role="tabpanel" aria-labelledby="closed-issues-tab">
                        <div v-for="issue in closedIssues">
                            {{ issue.title }}
                        </div>
                    </div>
                  </div>
            </div>
        </section>
    </div>
</body>

</html>